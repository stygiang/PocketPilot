generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum Cadence {
  WEEKLY
  BIWEEKLY
  MONTHLY
  CUSTOM
}

enum SubscriptionStatus {
  FREE
  PRO
  PAST_DUE
  CANCELED
}

model User {
  id                 String              @id @default(cuid())
  email              String              @unique
  passwordHash       String
  createdAt          DateTime            @default(now())
  settings           Settings?
  balanceSnapshots   BalanceSnapshot[]
  incomeSources      IncomeSource[]
  bills              Bill[]
  expenses           Expense[]
  subscription       Subscription?
}

model Settings {
  id                           String   @id @default(cuid())
  userId                       String   @unique
  timezone                     String   @default("UTC")
  plannedSavingsCentsPerPaycheck Int    @default(0)
  user                         User     @relation(fields: [userId], references: [id])
}

model BalanceSnapshot {
  id           String   @id @default(cuid())
  userId       String
  balanceCents Int
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId, createdAt])
}

model IncomeSource {
  id           String   @id @default(cuid())
  userId       String
  name         String
  amountCents  Int
  cadence      Cadence
  nextPayDate  DateTime
  active       Boolean  @default(true)
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Bill {
  id           String   @id @default(cuid())
  userId       String
  name         String
  amountCents  Int
  cadence      Cadence
  dueDayOfMonth Int?
  nextDueDate  DateTime?
  active       Boolean  @default(true)
  createdAt    DateTime @default(now())
  user         User     @relation(fields: [userId], references: [id])

  @@index([userId])
}

model Expense {
  id          String   @id @default(cuid())
  userId      String
  amountCents Int
  date        DateTime
  category    String?
  note        String?
  createdAt   DateTime @default(now())
  user        User     @relation(fields: [userId], references: [id])

  @@index([userId, date])
}

model Subscription {
  id                     String             @id @default(cuid())
  userId                 String             @unique
  stripeCustomerId       String?
  stripeSubscriptionId   String?
  status                 SubscriptionStatus @default(FREE)
  currentPeriodEnd       DateTime?
  user                   User               @relation(fields: [userId], references: [id])
}
